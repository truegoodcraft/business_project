<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>BUS Core</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/svg+xml" href="favicon.svg?v=buscore-8">
  <link rel="stylesheet" href="/ui/css/app.css">
  <script>
  (function(){
    const href = "favicon.svg?v=buscore-8";
    let link = document.querySelector('link[rel="icon"]');
    if(!link){ link=document.createElement('link'); link.rel='icon'; document.head.appendChild(link); }
    link.type = 'image/svg+xml'; link.href = href;
    document.querySelectorAll('link[rel="shortcut icon"],link[rel="apple-touch-icon"],link[rel="mask-icon"]').forEach(x=>x.remove());
  })();
  </script>
</head>
<body>
  <!-- Global Error Banner -->
  <div id="global-error-banner" class="hidden"></div>

  <nav id="sidebar">
    <a href="#/home" class="brand-header">
      <img src="favicon.svg" alt="Logo" class="brand-logo">
      <span class="brand-name">BUS Core</span>
    </a>

    <div class="nav-menu">
      <div class="nav-category">Tools</div>
      <a href="#/inventory" class="nav-item" data-role="nav-link" data-route="inventory">Inventory</a>
      <a href="#/manufacturing" class="nav-item" data-role="nav-link" data-route="manufacturing">Manufacturing</a>
      <a href="#/contacts" class="nav-item" data-role="nav-link" data-route="contacts">Contacts</a>
      <a href="#/recipes" class="nav-item" data-role="nav-link" data-route="recipes">Recipes</a>
      <div class="nav-spacer"></div>
      <a href="#/settings" class="nav-item" data-role="nav-link" data-route="settings">Settings</a>
    </div>
  </nav>

  <main id="main">
    <div id="app">

      <!-- Home screen container -->
      <div data-role="home-screen" class="card">
        <!-- 1) Primary actions -->
        <div class="home-actions">
          <button data-action="open-expense-modal" class="btn btn-red btn-large">Add Expense</button>
          <button data-action="open-revenue-modal" class="btn btn-green btn-large">Add Revenue</button>
        </div>

        <!-- 2) Net 30 (bold, one line) + 3) In/Out (smaller) -->
        <div class="snapshot">
          <div data-role="net-30" class="net-line">Net (Last 30 Days): $0.00</div>
          <div class="io-lines">
            <div class="donuts">
              <div data-role="donut-in"  class="donut donut-in"></div>
              <div data-role="donut-out" class="donut donut-out"></div>
            </div>
          </div>
        </div>

        <!-- 4) Last transactions (10) -->
        <div class="recent-table">
          <h3 class="table-title">Last transactions (10)</h3>
          <table data-role="recent-transactions">
            <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Notes</th></tr></thead>
            <tbody></tbody>
          </table>
          <!-- View All link intentionally removed until full table + donut shipped -->
        </div>
      </div>

      <!-- Contacts screen (hidden by default) -->
      <div data-role="contacts-screen" class="hidden">
        <div class="card" data-view="contacts">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;">
            <h2 style="margin:0;">Contacts</h2>
            <button type="button" data-action="open-contacts-modal">Add Contact</button>
          </div>
          <table data-role="contacts-table" class="table" style="width:100%;border-collapse:separate;border-spacing:0;background:#111318;border-radius:10px;overflow:hidden">
            <thead>
              <tr>
                <th style="text-align:left;padding:10px;background:#1a1f2b">Type</th>
                <th style="text-align:left;padding:10px;background:#1a1f2b">Contact</th>
                <th style="text-align:left;padding:10px;background:#1a1f2b">Actions</th>
              </tr>
            </thead>
            <tbody><!-- rows rendered by vendors.js --></tbody>
          </table>
        </div>
      </div>

      <div data-role="inventory-screen" class="hidden">
        <div data-role="inventory-root" class="card"></div>
      </div>

      <div data-role="manufacturing-screen" class="hidden">
        <div class="screen-header">
          <h1 style="margin:0;">Manufacturing</h1>
        </div>
        <div class="screen-body">
          <div data-tab-panel="manufacturing"></div>
        </div>
      </div>

      <div data-role="recipes-screen" class="hidden">
        <div class="screen-header">
          <h1 style="margin:0;">Recipes</h1>
        </div>
        <div class="screen-body">
          <div data-tab-panel="recipes"></div>
        </div>
      </div>

      <div data-role="settings-screen" class="hidden">
        <div data-role="settings-root"></div>
      </div>

      <div data-role="admin-screen" class="hidden">
        <div data-role="admin-root"></div>
      </div>

<!-- Expense modal — locked MVP fields -->
<div data-role="expense-modal" class="modal hidden" aria-hidden="true">
  <div class="modal-backdrop" data-action="close-expense-modal"></div>
  <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="expense-title">
    <form data-role="expense-form">
      <h2 id="expense-title">Add Expense</h2>
      <div class="field">
        <label>Amount <span class="required">*</span></label>
        <input type="number" step="0.01" name="amount" required inputmode="decimal" placeholder="0.00">
      </div>
      <div class="field">
        <label>Category</label>
        <input type="text" name="category" placeholder="e.g. filament">
      </div>
      <div class="field">
        <label>Date</label>
        <input type="date" name="date">
      </div>
      <div class="field">
        <label>Notes</label>
        <textarea name="notes" rows="2" placeholder="(optional)"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" data-action="close-expense-modal">Cancel</button>
        <button type="submit">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Revenue modal placeholder (unchanged) -->
<div data-role="revenue-modal" class="modal hidden">…</div>

      <!-- Tools screen (hidden by default) -->
      <div data-role="tools-screen" class="hidden">
        <!-- Simple list-only view for Tools -->
        <div data-role="tools-list">
          <h2 class="text-xl">Tools</h2>
          <ul>
            <li><a href="#/inventory">Inventory</a></li>
            <li><a href="#/contacts">Contacts</a></li>
          </ul>
        </div>

        <!-- Keep legacy Tools section but force hidden so its tabs/Contacts never show -->
        <section data-route="tools" class="hidden">
          <!-- Tools page header tabs (scoped to Tools page only) -->
          <div data-role="tools-tabs-root" class="hidden">
            <!-- Tabs header -->
            <div data-role="main-tabs" class="tabs">
              <button type="button" data-tab="manufacturing">Manufacturing</button>
              <button type="button" data-tab="tasks">Tasks</button>
              <button type="button" data-tab="backup">Backup</button>
            </div>

            <!-- Tabs panels (kept empty here; JS shows/hides) -->
            <section data-tab-panel="manufacturing" class="tab-panel hidden">
              <!-- Manufacturing stub form lives in JS or existing markup -->
            </section>
            <section data-tab-panel="tasks" class="tab-panel hidden">
              <!-- Local tasks table lives in JS or existing markup -->
            </section>
            <section data-tab-panel="backup" class="tab-panel hidden">
              <!-- Backup export button already present elsewhere; JS will wire -->
              <button data-action="export-backup" class="btn btn-primary btn-block">Export</button>
              <p>Downloads current app.db (or fallback endpoint).</p>
            </section>
          </div>
        </section>
      </div>
    </div>
  </main>

  <aside data-role="contacts-drawer" class="drawer hidden" aria-hidden="true" role="dialog" aria-labelledby="contact-drawer-title">
    <div class="drawer-backdrop" data-action="close-contacts-drawer"></div>
    <div class="drawer-panel">
      <header class="drawer-header">
        <h3 id="contact-drawer-title" style="margin:0;font-size:18px;color:#f8fafc">Contact</h3>
        <button type="button" data-action="close-contacts-drawer" aria-label="Close" style="background:transparent;border:none;color:#9ca3af;font-size:24px;cursor:pointer;line-height:1">×</button>
      </header>
      <section class="drawer-body">
        <div class="kv"><span class="k">Type</span><span class="v" data-field="type"></span></div>
        <div class="kv"><span class="k">Name</span><span class="v" data-field="name"></span></div>
        <div class="kv"><span class="k">Email</span><span class="v" data-field="email"></span></div>
        <div class="kv vendor-only"><span class="k">Material</span><span class="v" data-field="material"></span></div>
        <div class="kv"><span class="k">Lead time (days)</span><span class="v" data-field="lead_time_days"></span></div>
        <div class="kv"><span class="k">Notes</span><span class="v" data-field="notes"></span></div>

        <h4 class="mt">Linked items</h4>
        <ul data-role="linked-items" class="list"><!-- populated by vendors.js --></ul>
      </section>
    </div>
  </aside>

  <div id="contacts-modal"
       data-role="contacts-modal"
       role="dialog"
       aria-modal="true"
       aria-labelledby="contacts-modal-title"
       class="modal hidden">
    <div class="modal-backdrop" aria-hidden="true"></div>
    <div class="modal-dialog modal-content">
      <header class="modal-header">
        <h2 id="contacts-modal-title" class="modal-title">Add Contact</h2>
        <button type="button" data-action="close-contacts-modal" aria-label="Close">×</button>
      </header>

      <form data-role="contacts-form" class="modal-body">
        <div class="field">
          <label for="contact-name">Name</label>
          <input id="contact-name" name="name" type="text" required />
        </div>

        <div class="field">
          <label for="contact-type">Type</label>
          <select id="contact-type" name="type" required>
            <option value="">— Select —</option>
            <option value="vendor">Vendor</option>
            <option value="customer">Customer</option>
          </select>
        </div>

        <div class="field">
          <label for="contact-email">Email</label>
          <input id="contact-email" name="email" type="email" />
        </div>

        <div class="field" data-visible-when="vendor">
          <label for="contact-material">Material</label>
          <input id="contact-material" name="material" type="text" />
        </div>

        <div class="field">
          <label for="contact-leadtime">Lead time (days)</label>
          <input id="contact-leadtime" name="lead_time_days" type="number" inputmode="numeric" />
        </div>

        <div class="field">
          <label for="contact-notes">Notes</label>
          <textarea id="contact-notes" name="notes"></textarea>
        </div>

        <footer class="modal-footer">
          <button type="button" data-action="close-contacts-modal">Cancel</button>
          <button type="submit" data-role="contacts-save">Save</button>
        </footer>
      </form>
    </div>
  </div>

  <script type="module" src="/ui/app.js?v=pingfix2"></script>
</body>
</html>
